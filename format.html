<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Invoice Generator</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
        margin: 0;
      }
      h2 {
        margin-bottom: 10px;
      }
      .container {
        display: flex;
        width: 100%;
        max-width: none;
        box-sizing: border-box;
        min-height: 100vh;
        align-items: center; /* vertical center */
        justify-content: flex-start; /* left align */
        gap: 20px;
        padding: 20px;
        background-color: #4338ca;
      }
      .form-panel {
        flex: 0 0 320px;
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
      }
      .form-panel h2 {
        margin: 0 0 12px;
        font-size: 18px;
        font-weight: 600;
        color: #111827;
      }
      .form-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-bottom: 12px;
      }
      label {
        font-size: 12px;
        color: #374151;
      }
      input,
      textarea {
        padding: 8px 10px;
        border: 1px solid #d1d5db;
        border-radius: 4px;
        font-size: 14px;
        background: #fff;
      }
      textarea {
        resize: vertical;
        min-height: 60px;
      }
      .actions {
        margin-top: 8px;
      }
      button {
        padding: 8px 12px;
        border: 1px solid #111827;
        background: #111827;
        color: #fff;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- INVOICE -->
      <div class="invoice">
        <svg
          width="210mm"
          height="297mm"
          viewBox="10 40 210 140"
          xmlns="http://www.w3.org/2000/svg"
        >
          <!-- Background image -->
          <image href="format.jpg" x="0" y="0" width="60mm" height="55mm" />
          <!-- <tbody></tbody> -->
          <!-- Dynamic text fields positioned at exact coordinates -->
          <text
            id="serialDisplay"
            x="56"
            y="37.5"
            font-size="3.5"
            fill="black"
          ></text>
          <text
            id="billDate"
            x="163"
            y="45"
            font-size="3.5"
            fill="black"
          ></text>
          <text id="billTo" x="60" y="49.7" font-size="3.8" fill="black"></text>
          <text
            id="RemarksDisplay"
            x="60"
            y="55.5"
            font-size="3.8"
            fill="black"
          ></text>
          <text
            id="grandTotal"
            x="153"
            y="166"
            font-size="5"
            fill="red"
            font-weight="bold"
          >
            1500
          </text>
          <text id="amountWords" x="80" y="176" font-size="3.5" fill="red">
            ten thousand only
          </text>
          <g id="lineItemsLayer"></g>
        </svg>
      </div>
      <aside class="form-panel">
        <h2>Invoice Details</h2>
        <form id="invoiceForm">
          <div class="form-group">
            <label for="sno">S No</label>
            <input
              id="sno"
              name="sno"
              type="number"
              inputmode="numeric"
              oninput="
                document.getElementById('serialDisplay').textContent =
                  this.value
              "
            />
          </div>
          <div class="form-group">
            <label for="name">Name</label>
            <input
              id="name"
              name="name"
              type="text"
              oninput="
                document.getElementById('billTo').textContent = this.value
              "
            />
          </div>
          <div class="form-group">
            <label for="remarks">Remarks</label>
            <textarea
              id="remarks"
              name="remarks"
              oninput="
                document.getElementById('RemarksDisplay').textContent =
                  this.value
              "
            ></textarea>
          </div>
          <div class="form-group">
            <label for="date">Date</label>
            <input
              id="date"
              name="date"
              type="date"
              oninput="
                document.getElementById('billDate').textContent = this.value
              "
            />
          </div>
          <div class="form-group">
            <label for="particulars">Particulars</label>
            <input id="particulars" name="particulars" type="text" />
          </div>
          <div class="form-group">
            <label for="km">KM</label>
            <input
              id="km"
              name="km"
              type="number"
              step="0.1"
              inputmode="decimal"
              oninput="updateComputed()"
            />
          </div>
          <div class="form-group">
            <label for="fare_per_km">Fare/km</label>
            <input
              id="fare_per_km"
              name="fare_per_km"
              type="number"
              step="0.01"
              inputmode="decimal"
              oninput="updateComputed()"
            />
          </div>
          <div class="actions">
            <button type="button" id="addLineBtn" onclick="addLine()">
              ADD
            </button>
          </div>
        </form>
      </aside>
    </div>
    <script>
      // Map form fields to SVG text element IDs and handle computed values
      const bindings = [
        { input: "sno", svgId: "serialDisplay" },
        { input: "date", svgId: "billDate" },
        { input: "name", svgId: "billTo" },
        { input: "remarks", svgId: "RemarksDisplay" },
        { input: "km", svgId: "grandTotal", compute: true },
        { input: "fare_per_km", svgId: "grandTotal", compute: true },
      ];

      function formatNumber(n) {
        if (isNaN(n) || n === null || n === "") return "";
        return Number(n).toLocaleString(undefined, {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        });
      }

      function numberToWordsSimple(n) {
        if (n === "" || n === null || isNaN(n)) return "";
        return `Amount: ${formatNumber(n)}`; // simple wording placeholder
      }

      function updateComputed() {
        const km = parseFloat(document.getElementById("km")?.value || "");
        const rate = parseFloat(
          document.getElementById("fare_per_km")?.value || "",
        );
        const total = isNaN(km) || isNaN(rate) ? "" : km * rate;
        const gt = document.getElementById("grandTotal");
        if (gt) gt.textContent = total === "" ? "" : formatNumber(total);
        const aw = document.getElementById("amountWords");
        if (aw) aw.textContent = total === "" ? "" : numberToWordsSimple(total);
      }

      const tableLayout = {
        // Exact coordinates per your spec
        startY: 90, // first row Y
        rowGap: 7, // gap between rows
        x: {
          km: 118, // "<km> km"
          times: 130, // "x"
          fare: 133, // "₹<fare>"
          total: 157, // "₹<total>"
        },
        fontSize: 4,
        fill: "black",
      };
      let lineIndex = 0;

      function addLine() {
        const kmValStr = (document.getElementById("km")?.value || "").trim();
        const fareValStr = (
          document.getElementById("fare_per_km")?.value || ""
        ).trim();
        if (!kmValStr && !fareValStr) return;
        const kmVal = parseFloat(kmValStr);
        const fareVal = parseFloat(fareValStr);
        const totalVal =
          !isNaN(kmVal) && !isNaN(fareVal) ? kmVal * fareVal : NaN;

        const layer = document.getElementById("lineItemsLayer");
        if (!layer) return;

        const y = tableLayout.startY + lineIndex * tableLayout.rowGap;
        const ns = "http://www.w3.org/2000/svg";
        const makeText = (x, text) => {
          const t = document.createElementNS(ns, "text");
          t.setAttribute("x", String(x));
          t.setAttribute("y", String(y));
          t.setAttribute("font-size", String(tableLayout.fontSize));
          t.setAttribute("fill", tableLayout.fill);
          t.textContent = text;
          return t;
        };

        const kmText = isNaN(kmVal) ? "" : `${kmVal} km`;
        const fareText = isNaN(fareVal) ? "" : `₹${fareVal}`;
        const totalText = isNaN(totalVal) ? "" : `₹${totalVal}`;

        layer.appendChild(makeText(tableLayout.x.km, kmText));
        layer.appendChild(makeText(tableLayout.x.times, "x"));
        layer.appendChild(makeText(tableLayout.x.fare, fareText));
        layer.appendChild(makeText(tableLayout.x.total, totalText));

        lineIndex += 1;
        // clear numeric inputs and recompute
        const k = document.getElementById("km");
        if (k) k.value = "";
        const f = document.getElementById("fare_per_km");
        if (f) f.value = "";
        updateComputed();
      }

      function bind() {
        // Wire up ADD button click -> add a line without submitting/reloading
        const addBtn = document.getElementById("addLineBtn");
        if (addBtn)
          addBtn.addEventListener("click", (ev) => {
            ev.preventDefault();
            addLine();
          });

        bindings.forEach(({ input, svgId, compute }) => {
          const el = document.getElementById(input);
          const svgText = document.getElementById(svgId);
          if (!el || !svgText) return;
          const handler = () => {
            if (compute) {
              updateComputed();
              return;
            }
            svgText.textContent = el.value;
          };
          el.addEventListener("input", handler);
          handler();
        });
      }

      if (document.readyState !== "loading") {
        bind();
      } else {
        document.addEventListener("DOMContentLoaded", bind);
      }
    </script>
  </body>
</html>
